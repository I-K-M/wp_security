#!/bin/bash

LOGFILE="./scan-result.log"
exec > >(tee -a "$LOGFILE") 2>&1

echo '=== ðŸ” wp full scan ==='
echo ''

echo '--- ðŸ“ php files scan ---'
echo 'ðŸ” wp-content/cache â†’ eval('
grep -r --include='*.php' "eval(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ base64_decode('
grep -r --include='*.php' "base64_decode(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ gzinflate('
grep -r --include='*.php' "gzinflate(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ gzuncompress('
grep -r --include='*.php' "gzuncompress(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ str_rot13('
grep -r --include='*.php' "str_rot13(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ shell_exec('
grep -r --include='*.php' "shell_exec(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ exec('
grep -r --include='*.php' "exec(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ passthru('
grep -r --include='*.php' "passthru(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ system('
grep -r --include='*.php' "system(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ assert('
grep -r --include='*.php' "assert(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ preg_replace('
grep -r --include='*.php' "preg_replace(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ create_function('
grep -r --include='*.php' "create_function(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ file_put_contents('
grep -r --include='*.php' "file_put_contents(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ curl_exec('
grep -r --include='*.php' "curl_exec(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ popen('
grep -r --include='*.php' "popen(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ proc_open('
grep -r --include='*.php' "proc_open(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ fopen('
grep -r --include='*.php' "fopen(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/cache â†’ php_uname('
grep -r --include='*.php' "php_uname(" wp-content/cache 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ eval('
grep -r --include='*.php' "eval(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ base64_decode('
grep -r --include='*.php' "base64_decode(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ gzinflate('
grep -r --include='*.php' "gzinflate(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ gzuncompress('
grep -r --include='*.php' "gzuncompress(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ str_rot13('
grep -r --include='*.php' "str_rot13(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ shell_exec('
grep -r --include='*.php' "shell_exec(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ exec('
grep -r --include='*.php' "exec(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ passthru('
grep -r --include='*.php' "passthru(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ system('
grep -r --include='*.php' "system(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ assert('
grep -r --include='*.php' "assert(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ preg_replace('
grep -r --include='*.php' "preg_replace(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ create_function('
grep -r --include='*.php' "create_function(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ file_put_contents('
grep -r --include='*.php' "file_put_contents(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ curl_exec('
grep -r --include='*.php' "curl_exec(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ popen('
grep -r --include='*.php' "popen(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ proc_open('
grep -r --include='*.php' "proc_open(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ fopen('
grep -r --include='*.php' "fopen(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/uploads â†’ php_uname('
grep -r --include='*.php' "php_uname(" wp-content/uploads 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ eval('
grep -r --include='*.php' "eval(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ base64_decode('
grep -r --include='*.php' "base64_decode(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ gzinflate('
grep -r --include='*.php' "gzinflate(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ gzuncompress('
grep -r --include='*.php' "gzuncompress(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ str_rot13('
grep -r --include='*.php' "str_rot13(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ shell_exec('
grep -r --include='*.php' "shell_exec(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ exec('
grep -r --include='*.php' "exec(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ passthru('
grep -r --include='*.php' "passthru(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ system('
grep -r --include='*.php' "system(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ assert('
grep -r --include='*.php' "assert(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ preg_replace('
grep -r --include='*.php' "preg_replace(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ create_function('
grep -r --include='*.php' "create_function(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ file_put_contents('
grep -r --include='*.php' "file_put_contents(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ curl_exec('
grep -r --include='*.php' "curl_exec(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ popen('
grep -r --include='*.php' "popen(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ proc_open('
grep -r --include='*.php' "proc_open(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ fopen('
grep -r --include='*.php' "fopen(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/plugins â†’ php_uname('
grep -r --include='*.php' "php_uname(" wp-content/plugins 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ eval('
grep -r --include='*.php' "eval(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ base64_decode('
grep -r --include='*.php' "base64_decode(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ gzinflate('
grep -r --include='*.php' "gzinflate(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ gzuncompress('
grep -r --include='*.php' "gzuncompress(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ str_rot13('
grep -r --include='*.php' "str_rot13(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ shell_exec('
grep -r --include='*.php' "shell_exec(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ exec('
grep -r --include='*.php' "exec(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ passthru('
grep -r --include='*.php' "passthru(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ system('
grep -r --include='*.php' "system(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ assert('
grep -r --include='*.php' "assert(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ preg_replace('
grep -r --include='*.php' "preg_replace(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ create_function('
grep -r --include='*.php' "create_function(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ file_put_contents('
grep -r --include='*.php' "file_put_contents(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ curl_exec('
grep -r --include='*.php' "curl_exec(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ popen('
grep -r --include='*.php' "popen(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ proc_open('
grep -r --include='*.php' "proc_open(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ fopen('
grep -r --include='*.php' "fopen(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/themes â†’ php_uname('
grep -r --include='*.php' "php_uname(" wp-content/themes 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ eval('
grep -r --include='*.php' "eval(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ base64_decode('
grep -r --include='*.php' "base64_decode(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ gzinflate('
grep -r --include='*.php' "gzinflate(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ gzuncompress('
grep -r --include='*.php' "gzuncompress(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ str_rot13('
grep -r --include='*.php' "str_rot13(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ shell_exec('
grep -r --include='*.php' "shell_exec(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ exec('
grep -r --include='*.php' "exec(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ passthru('
grep -r --include='*.php' "passthru(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ system('
grep -r --include='*.php' "system(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ assert('
grep -r --include='*.php' "assert(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ preg_replace('
grep -r --include='*.php' "preg_replace(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ create_function('
grep -r --include='*.php' "create_function(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ file_put_contents('
grep -r --include='*.php' "file_put_contents(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ curl_exec('
grep -r --include='*.php' "curl_exec(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ popen('
grep -r --include='*.php' "popen(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ proc_open('
grep -r --include='*.php' "proc_open(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ fopen('
grep -r --include='*.php' "fopen(" wp-content/mu-plugins 2>/dev/null
echo 'ðŸ” wp-content/mu-plugins â†’ php_uname('
grep -r --include='*.php' "php_uname(" wp-content/mu-plugins 2>/dev/null

echo ''
echo '--- ðŸ§  db scan ---'
echo ''
# change ids
DB_NAME='name'
DB_USER='user'
DB_PASS='password'
DB_HOST='localhost'

SQL_TEMP=$(mktemp)
cat <<'EOF' > "$SQL_TEMP"
-- wp_options w base64
SELECT 'wp_options' AS context, option_name, option_value 
FROM wp_options 
WHERE option_value LIKE '%base64%';

-- wp_posts w <script
SELECT 'wp_posts' AS context, post_title, post_content 
FROM wp_posts 
WHERE post_content LIKE '%<script%';

-- cron
SELECT 'wp_options (cron)' AS context, option_name, option_value 
FROM wp_options 
WHERE option_name = 'cron';

-- transients w eval
SELECT 'transients eval' AS context, option_name, option_value 
FROM wp_options 
WHERE option_name LIKE '_transient%' AND option_value LIKE '%eval%';

-- transients w malicious patterns
SELECT 'transients (dangerous)' AS context, option_name, option_value 
FROM wp_options 
WHERE option_name LIKE '_transient%' AND (
  option_value LIKE '%base64%' OR 
  option_value LIKE '%gzinflate%' OR 
  option_value LIKE '%gzuncompress%' OR 
  option_value LIKE '%str_rot13%' OR 
  option_value LIKE '%eval%' OR 
  option_value LIKE '%preg_replace%' OR
  option_value LIKE '%shell_exec%' OR
  option_value LIKE '%assert(%'
);

-- autoload
SELECT 'wp_options (autoload size)' AS context, option_name, LENGTH(option_value) AS size 
FROM wp_options 
WHERE autoload = 'yes' 
ORDER BY size DESC 
LIMIT 50;

-- users
SELECT 'wp_users' AS context, ID, user_login, user_email, user_registered, user_status, display_name
FROM wp_users;

-- user capabilities
SELECT 'wp_usermeta (capabilities)' AS context, user_id, meta_key, meta_value
FROM wp_usermeta 
WHERE meta_key LIKE '%capabilities%';
EOF

mysql -u "$DB_USER" -p"$DB_PASS" -h "$DB_HOST" "$DB_NAME" < "$SQL_TEMP" | tee -a "$LOGFILE"
rm "$SQL_TEMP"
echo ''
echo "âœ… scan completed: see results in $LOGFILE"